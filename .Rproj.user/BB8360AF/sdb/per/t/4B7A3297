{
    "collab_server" : "",
    "contents" : "## Reginald Edwards\n## 16 June 2018\n## 25 June 2018\n## Analyze distribution of earnings beats/small profits and losses\n###############################################################################\n\nrm(list=ls())\ngc()\n\nload(\"data/comp_fundq.RData\")\nX <- comp.fundq\n\nsummary(X$epspxq)\nhist(X$epspxq)\npercentiles <- quantile(X$epspxq, probs = seq(0,1,.01))\np01 <- percentiles[[\"1%\"]]\np99 <- percentiles[[\"99%\"]]\n\n## ECDF\n## Full-sample mean of EPS\neps.mean <- round(mean(X$epspxq),2)\nplot(ecdf(X$epspxq), xlim = c(p01,p99))\nabline(h = .5, col = 'blue', lty = 3)\nabline(v = median(X$epspxq), col = 'blue', lty = 3)\nabline(v = eps.mean, col = 'blue', lty = 3)\ntext(x = median(X$epspxq), y = .4, median(X$epspxq))\ntext(x = eps.mean, y = .7, eps.mean)\n\n\n## Winsorize and histogram\nepspxq.1 <- X$epspxq\nepspxq.1 <- pmin(epspxq.1, p99*1.1)\nepspxq.1 <- pmax(epspxq.1, p01*0.9)\nhist(epspxq.1)\n\n###############################################################################\n## Winsorize EPS by year\n###############################################################################\n\n###############################################################################\n## Earnings management measures\n###############################################################################\n\n## Small losses/gains\nn <- nrow(X)\nsmall.losses <- which(X$epspxq == -.01)\nsmall.gains <- which(X$epspxq == .01)\nzero.eps <- which(X$epspxq == 0)\n\n100*length(small.losses)/n\n100*length(small.gains)/n\n100*length(zero.eps)/n\n\nX$small.loss <- 1*(X$epspxq == -0.01)\nX$small.gain <- 1*(X$epspxq == 0.01)\nX$zero.eps <- 1*(X$epspxq == 0)\n\nsmall.losses.by.qtr <- aggregate(X$small.loss, by = list(X$datacqtr), FUN = mean)\nnames(small.losses.by.qtr) <- c(\"datacqtr\", \"small.losses\")\n\nsmall.gains.by.qtr <- aggregate(X$small.gain, by = list(X$datacqtr), FUN = mean)\nnames(small.gains.by.qtr) <- c(\"datacqtr\", \"small.gains\")\n\nzero.eps.by.qtr <- aggregate(X$zero.eps, by = list(X$datacqtr), FUN = mean)\nnames(zero.eps.by.qtr) <- c(\"datacqtr\", \"zero.eps\")\n\nsize.by.quarter <- aggregate(X$atq, by = list(X$datacqtr), FUN = median)\nnames(size.by.quarter) <- c(\"datacqtr\", \"med.atq\")\nthreshholds.by.qtr <- merge(small.losses.by.qtr, small.gains.by.qtr)\nthreshholds.by.qtr <- merge(threshholds.by.qtr, zero.eps.by.qtr)\nthreshholds.by.qtr <- merge(threshholds.by.qtr, size.by.quarter)\n\nplot(threshholds.by.qtr$small.losses, type = 'l', \n     xlim = c(50, 200), ylim = c(0,.03), col = 'red')\nlines(threshholds.by.qtr$small.gains, col = 'green')\nlines(threshholds.by.qtr$zero.eps, col = rgb(0,0,1,.3), lty = 3)\n\n\n\n## Transition matrix of EPS from one quarter to the next.\n## Given a certain EPS last quarter, how likely are you to have different\n## realizations of EPS next quarter?",
    "created" : 1529175769527.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "590486017",
    "id" : "4B7A3297",
    "lastKnownWriteTime" : 1529974610,
    "last_content_update" : 1530221376255,
    "path" : "C:/Users/Reginald/Dropbox/Research/earnings/code/earnings-distribution.R",
    "project_path" : "code/earnings-distribution.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}